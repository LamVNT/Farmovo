@startuml Balance_List_Sequence

skinparam backgroundColor white
skinparam sequenceArrowThickness 2
skinparam sequenceMessageAlign center
skinparam sequenceGroupBodyBackgroundColor #F8F9FA
skinparam sequenceParticipantBorderColor #6C757D
skinparam sequenceParticipantBackgroundColor #E9ECEF
skinparam sequenceLifeLineStroke dash
skinparam actorBackgroundColor #FFD700

title Balance – List (Paged & Filtered)

actor Staff
participant ":Balance Page" as ListUI
participant ":balanceTransactionService (FE)" as FEListSvc
participant ":SaleTransactionController" as SaleController
participant ":SaleTransactionServiceImpl" as SaleService
participant ":SaleTransactionRepository" as SaleRepo

note over ListUI,SaleService: Chỉ liệt kê các phiếu cân bằng được tạo từ Stocktake. Filter bằng note chứa "Cân bằng kho" hoặc stocktakeId != null.

== A. Tải danh sách phiếu cân bằng ==
Staff -> ListUI: Mở trang danh sách Balance
activate Staff
activate ListUI
ListUI -> FEListSvc: fetch list {filters, isBalanceStock=true}
activate FEListSvc
FEListSvc -> SaleController: GET /sale-transactions/list-all?isBalanceStock=true&...
activate SaleController
SaleController -> SaleService: getAll(...)
activate SaleService
SaleService -> SaleService: apply balance filter (note or stocktakeId)
SaleService -> SaleRepo: query paged
SaleRepo --> SaleService: Page<SaleTransaction>
SaleService -> SaleService: map to Page<SaleTransactionResponseDto>
SaleService --> SaleController: Page<SaleTransactionResponseDto>
SaleController --> FEListSvc: 200 OK + data
FEListSvc --> ListUI: render table/pagination
ListUI --> Staff: Hiển thị danh sách phiếu cân bằng

deactivate SaleService
deactivate SaleController
deactivate FEListSvc
deactivate ListUI
deactivate Staff

@enduml 