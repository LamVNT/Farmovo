@startuml Stocktake_Delete_Sequence

skinparam backgroundColor white
skinparam sequenceArrowThickness 2
skinparam sequenceMessageAlign center
skinparam sequenceGroupBodyBackgroundColor #F8F9FA
skinparam sequenceParticipantBorderColor #6C757D
skinparam sequenceParticipantBackgroundColor #E9ECEF
skinparam sequenceLifeLineStroke dash

title Delete StockTake - Sequence Diagram

actor User as U
participant "StocktakeController" as CC
participant "StocktakeService" as CS
participant "StocktakeRepository" as CR
database "Database" as DB

== Request Phase ==
U -> CC: DELETE /api/stocktakes/{id}
activate CC

CC -> CS: deleteStocktake(id)
activate CS
CS -> CR: findById(id)
activate CR
CR -> DB: SELECT * FROM stocktakes WHERE id = ?
DB --> CR: Stocktake or null
CR --> CS: Optional<Stocktake>
deactivate CR
alt Stocktake Not Found
    CS -> CS: throw new StocktakeNotFoundException(...)
    CS --> CC: StocktakeNotFoundException
    CC --> U: 404 Not Found\n{error message}
else Stocktake Found
    CS -> CR: delete(stocktake)
    activate CR
    CR -> DB: DELETE FROM stocktakes WHERE id = ?
    DB --> CR: deletion result
    CR --> CS: void
    deactivate CR
    CS --> CC: void
    CC --> U: 204 No Content
end

deactivate CS
deactivate CC

@enduml 