@startuml Category_Delete_Sequence

skinparam backgroundColor white
skinparam sequenceArrowThickness 2
skinparam sequenceMessageAlign center
skinparam sequenceGroupBodyBackgroundColor #F8F9FA
skinparam sequenceParticipantBorderColor #6C757D
skinparam sequenceParticipantBackgroundColor #E9ECEF
skinparam sequenceLifeLineStroke dash

title Delete Category - Sequence Diagram

actor User as U
participant ":Category Page" as UI
participant ":CategoryController" as CC
participant ":CategoryService" as CS
participant ":CategoryRepository" as CR

== Request Phase ==
U -> UI: Chọn category, nhấn "Xóa"
activate U
activate UI
UI -> CC: DELETE /api/categories/{id}
activate CC
CC -> CS: deleteCategory(id)
activate CS
CS -> CR: findById(id)
activate CR
CR --> CS: Optional<Category>
deactivate CR
alt Category Not Found
    CS --> CC: CategoryNotFoundException
    CC --> UI: 404 Not Found {error message}
    UI --> U: Hiển thị lỗi
else Category Found
    CS -> CS: check if products list is empty
    alt Category has Products
        CS --> CC: Cannot delete category with products
        CC --> UI: 400 Bad Request "Cannot delete category with existing products"
        UI --> U: Hiển thị lỗi
    else Category has no Products
        CS -> CR: delete(category)
        activate CR
        CR --> CS: void
        deactivate CR
        CS --> CC: void
        CC --> UI: 204 No Content
        UI --> U: Xóa thành công, cập nhật danh sách
    end
end

deactivate CS
deactivate CC
deactivate UI
deactivate U

note right of UI
    Response: 204 No Content hoặc lỗi 404/400
end note

@enduml 