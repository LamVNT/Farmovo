@startuml
skinparam classAttributeIconSize 0
skinparam linetype ortho

' ======================== DTO ========================
package "DTO" {
  class CreateImportTransactionRequestDto {
    - id: Long
    - name: String
    - supplierId: Long
    - status: ImportTransactionStatus
    - storeId: Long
    - staffId: Long
    - totalAmount: BigDecimal
    - paidAmount: BigDecimal
    - importTransactionNote: String
    - importDate: LocalDateTime
    - createdBy: Long
    - details: List<DetailDto>
  }

  class DetailDto {
    - productId: Long
    - name: String
    - productName: String
    - importQuantity: Integer
    - remainQuantity: Integer
    - expireDate: LocalDateTime
    - unitImportPrice: BigDecimal
    - unitSalePrice: BigDecimal
    - zones_id: List<String>
  }

  CreateImportTransactionRequestDto *-- "1..*" DetailDto : contains
}

' ======================== Service ========================
package "Service" {
  interface ImportTransactionService {
    +createImportTransaction(dto: CreateImportTransactionRequestDto, userId: Long): void
    +getNextImportTransactionCode(): String
  }
  
  class ImportTransactionServiceImpl {
    -importTransactionRepository: ImportTransactionRepository
    -customerService: CustomerService
    -productService: ProductService
    -storeService: StoreService
    -userService: UserService
    --
    +createImportTransaction(dto: CreateImportTransactionRequestDto, userId: Long): void
    +getNextImportTransactionCode(): String
    -mapDtoToTransaction(ImportTransaction transaction, 
        CreateImportTransactionRequestDto dto, boolean isCreate, Long userId): void
    -generateDetailCodes(ImportTransaction transaction): void
    -validateImportTransaction(dto: CreateImportTransactionRequestDto): void
  }
}

' ======================== Repository ========================
package "Repository" {
  class ImportTransactionRepository {
    +findById(id: Long): Optional<ImportTransaction>
    +findTopByOrderByIdDesc(): Optional<ImportTransaction>
    +save(importTransaction: ImportTransaction): ImportTransaction
  }
}

' ======================== Controller ========================
package "Controller" {
  class ImportTransactionController {
    +create(dto: CreateImportTransactionRequestDto, userId: Long)
  }
}

' ======================== Entity ========================
package "Entity" {
  abstract class Base {
    #createdAt: LocalDateTime
    #createdBy: Long
    #updatedAt: LocalDateTime
    #deletedAt: LocalDateTime
    #deletedBy: Long
  }
  
  class ImportTransaction {
    - id: Long
    - name: String
    - status: ImportTransactionStatus
    - importDate: LocalDateTime
    - totalAmount: BigDecimal
    - paidAmount: BigDecimal
    - importTransactionNote: String
    - store: Store
    - supplier: Customer
    - staff: User
    - details: List<ImportTransactionDetail>
  }

  class ImportTransactionDetail {
    - id: Long
    - importQuantity: Integer
    - remainQuantity: Integer
    - expireDate: LocalDateTime
    - unitImportPrice: BigDecimal
    - unitSalePrice: BigDecimal
    - product: Product
    - importTransaction: ImportTransaction
  }

  class Product {
    - id: Long
    - name: String
    ...
  }

  class Store {
    - id: Long
    - name: String
    ...
  }

  class Customer {
    - id: Long
    - name: String
    ...
  }

  class User {
    - id: Long
    - username: String
    ...
  }

  ' === Entity Relationships ===
  ImportTransaction --|> Base
  ImportTransactionDetail --|> Base
  Customer --|> Base
  Product --|> Base
  Store --|> Base
  User --|> Base
  
  ImportTransaction "1" o-- "*" ImportTransactionDetail : details
  ImportTransactionDetail "*" --> "1" Product : product
  ImportTransaction "*" --> "1" Customer : supplier
  ImportTransaction "*" --> "1" Store : store
  ImportTransaction "*" --> "1" User : staff
  ImportTransactionDetail "*" --> "1" ImportTransaction : belongs to
}

' ======================== Application Layer Links ========================
ImportTransactionController --> ImportTransactionService : uses
ImportTransactionServiceImpl ..|> ImportTransactionService : implements
ImportTransactionServiceImpl --> ImportTransactionRepository : accesses
ImportTransactionService --> CreateImportTransactionRequestDto : uses
ImportTransactionRepository --> ImportTransaction : manages

@enduml 