@startuml Stocktake_Read_Sequence

skinparam backgroundColor white
skinparam sequenceArrowThickness 2
skinparam sequenceMessageAlign center
skinparam sequenceGroupBodyBackgroundColor #F8F9FA
skinparam sequenceParticipantBorderColor #6C757D
skinparam sequenceParticipantBackgroundColor #E9ECEF
skinparam sequenceLifeLineStroke dash

title Get/List StockTake - Sequence Diagram (Paged + Role Filter)

actor User
participant ":StockTake Page" as UI
participant ":StocktakeController" as CC
participant ":StocktakeServiceImpl" as CS
participant ":StocktakeMapper" as CM
participant ":StocktakeRepository" as CR
participant ":Zone/Store/Category API" as ExtAPI

User -> UI: Mở StockTake Page
activate User
activate UI

par Fetch data cho filter
  UI -> ExtAPI: GET Store/Zone/Category
  activate ExtAPI
  ExtAPI --> UI: Trả danh sách filter
  deactivate ExtAPI
end

UI -> CC: GET /api/stocktakes/paged?filters&page&size
activate CC
CC -> CM: toFilterObject(filters)
activate CM
CM --> CC: StocktakeFilter
deactivate CM

CC -> CS: searchStocktakes(filter, pageable)
activate CS

CS -> CS: validateRequest(filter, pageable)
note right: Kiểm tra quyền, tham số

CS -> CR: findAll(Specification, Pageable)
activate CR
CR --> CS: Page<Stocktake>
deactivate CR

CS -> CM: toResponseDto(list<Stocktake>)
activate CM
CM --> CS: List<StocktakeResponseDto>
deactivate CM

CS --> CC: Page<StocktakeResponseDto>
deactivate CS

CC --> UI: 200 OK
UI --> User: Hiển thị danh sách + phân trang

deactivate CC
deactivate UI
deactivate User

note right of UI
    StocktakeResponseDto:
    - id, name, date, status, note
    - storeName, detail, hasBalance
end note

@enduml
