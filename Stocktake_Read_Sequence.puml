@startuml Stocktake_Read_Sequence

skinparam backgroundColor white
skinparam sequenceArrowThickness 2
skinparam sequenceMessageAlign center
skinparam sequenceGroupBodyBackgroundColor #F8F9FA
skinparam sequenceParticipantBorderColor #6C757D
skinparam sequenceParticipantBackgroundColor #E9ECEF
skinparam sequenceLifeLineStroke dash
skinparam actorBackgroundColor #FFD700

title Get/List StockTake - Sequence Diagram

actor User
participant ":StockTake Page" as UI
participant ":StocktakeController" as CC
participant ":StocktakeServiceImpl" as CS
participant ":StocktakeMapper" as CM
participant ":StocktakeRepository" as CR

User -> UI: Yêu cầu xem danh sách kiểm kê
activate User
activate UI
UI -> CC: GET /api/stocktakes
activate CC
CC -> CS: getAllStocktakes()
activate CS
CS -> CR: findAll(): List<Stocktake>
activate CR
alt Repository Error
    CR --> CS: throw RepositoryException
    CS --> CC: return 500 Internal Server Error
    CC --> UI: return 500 Internal Server Error
    UI --> User: Hiển thị lỗi
else Success
    CR --> CS: return List<Stocktake>
    deactivate CR
    alt Empty List
        CS --> CC: return 404 Not Found {no stocktakes found}
        CC --> UI: return 404 Not Found {no stocktakes found}
        UI --> User: Hiển thị thông báo "Không có kiểm kê"
    else Non-Empty List
        loop For each Stocktake
            CS -> CM: toResponseDto(stocktake)
            activate CM
            CM --> CS: return StocktakeResponseDto
            deactivate CM
        end
        CS --> CC: return List<StocktakeResponseDto>
        deactivate CS
        CC --> UI: return 200 OK List<StocktakeResponseDto>
        UI --> User: Hiển thị danh sách kiểm kê
    end
end

deactivate CC
deactivate UI
deactivate User

note right of UI
    StocktakeResponseDto contains: id, stocktakeDate, detail, note, storeId
end note

@enduml