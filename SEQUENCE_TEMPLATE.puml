@startuml USE_CASE_TITLE

skinparam backgroundColor white
skinparam sequenceArrowThickness 2
skinparam sequenceMessageAlign center
skinparam sequenceGroupBodyBackgroundColor #F8F9FA
skinparam sequenceParticipantBorderColor #6C757D
skinparam sequenceParticipantBackgroundColor #E9ECEF
skinparam sequenceLifeLineStroke dash
skinparam noteBackgroundColor #FFFBE6
skinparam noteBorderColor #F0AD4E
skinparam {
  ArrowColor #343A40
}
skinparam actor {
  BackgroundColor #FFF3CD
  BorderColor #6C757D
}

' Title
' Replace with specific use case
' Example: title Create Category – Sequence Diagram
'title USE_CASE_TITLE – Sequence Diagram

' 1) Participants in MVC order: Actor → View → Controller → Service → Repository → (DB/API)
actor Staff
participant ":List Page" as ListUI
participant ":Create Page" as CreateUI
participant ":XController" as Ctrl
participant ":XServiceImpl" as Svc
participant ":XRepository" as Repo
database "DB" as DB

== A. Load dữ liệu ban đầu ==
Staff -> ListUI: Truy cập trang
activate Staff
activate ListUI
ListUI -> Ctrl: GET /api/x
activate Ctrl
Ctrl -> Svc: getInitialData(params)
activate Svc
Svc -> Repo: findAll()
activate Repo
Repo --> Svc: List<Entity>
deactivate Repo
Svc --> Ctrl: List<DTO>
deactivate Svc
Ctrl --> ListUI: 200 OK List<DTO>
deactivate Ctrl
ListUI --> Staff: Hiển thị danh sách

deactivate ListUI
deactivate Staff

== B. Submit tạo mới ==
Staff -> CreateUI: Nhấn "Tạo mới"
activate Staff
activate CreateUI
CreateUI -> Ctrl: POST /api/x {payload}
activate Ctrl
Ctrl -> Svc: createX(requestDto)
activate Svc

' 3) Validate tại Service ngay khi nhận từ Controller
Svc -> Svc: validate(requestDto)

alt Validation Failed
  Svc --> Ctrl: throw ValidationException
  Ctrl --> CreateUI: 400 Bad Request {error message}
  CreateUI --> Staff: Hiển thị lỗi
else Validation Passed
  ' Mapping nếu có
  Svc -> Svc: toEntity(requestDto)
  
  ' 2) Gọi repository có activation và trả về entity/DTO
  Svc -> Repo: save(entity)
  activate Repo
  Repo --> Svc: Entity (saved)
  deactivate Repo
  
  Svc -> Svc: toResponseDto(entity)
  Svc --> Ctrl: ResponseDto
  deactivate Svc
  Ctrl --> CreateUI: 201 Created + ResponseDto
  deactivate Ctrl
  CreateUI --> Staff: Hiển thị kết quả
end

deactivate CreateUI
deactivate Staff

' 5) Ghi chú nghiệp vụ
note right of Svc
  - Validate tất cả field bắt buộc
  - Ném ValidationException nếu fail
  - Chỉ gọi Repo khi validate pass
end note

' 7) Mẹo trình bày
' - Tối ưu nhóm bước bằng == A/B/C ==
' - Tách UI List/Create nếu có
' - Giữ câu lệnh ngắn gọn, rõ input/output

@enduml 