@startuml Dashboard_Sequence

skinparam backgroundColor white
skinparam sequenceArrowThickness 2
skinparam sequenceMessageAlign center
skinparam sequenceGroupBodyBackgroundColor #F8F9FA
skinparam sequenceParticipantBorderColor #6C757D
skinparam sequenceParticipantBackgroundColor #E9ECEF
skinparam sequenceLifeLineStroke dash

title Dashboard – Load Overview (Summary + Charts + Recent)

actor Staff
participant ":Dashboard Page" as UI
participant ":ReportController" as RC
participant ":ReportServiceImpl" as RS
participant ":ImportTransationController" as ImportCtrl
participant ":SaleTransactionController" as SaleCtrl
participant ":ImportTransactionRepository" as ImportRepo
participant ":SaleTransactionRepository" as SaleRepo
participant ":ImportTransactionDetailRepository" as DetailRepo

== A. Load Dashboard Summary ==
Staff -> UI: Mở Dashboard
activate Staff
activate UI
UI -> RC: GET /api/reports/remain-summary
activate RC
RC -> RS: getRemainSummary()
activate RS
RS -> DetailRepo: findByRemainQuantityGreaterThan(0)
activate DetailRepo
DetailRepo --> RS: List<ImportTransactionDetail>
deactivate DetailRepo
RS -> RS: aggregate totals (products, customers, suppliers, imports, sales, revenue, expiring)
RS --> RC: Summary DTO
deactivate RS
RC --> UI: 200 OK Summary
deactivate RC

== B. Charts Data ==
par Revenue Trend
  UI -> RC: GET /api/reports/revenue-trend?type={day|month|year}&from&to
  activate RC
  RC -> RS: getRevenueTrend(type, from, to)
  activate RS
  RS -> SaleRepo: getRevenueBy{Day|Month|Year}(from, to)
  activate SaleRepo
  SaleRepo --> RS: List<Object[]>
  deactivate SaleRepo
  RS -> RS: map to List<RevenueTrendDto>
  RS --> RC: List<RevenueTrendDto>
  deactivate RS
  RC --> UI: 200 OK
  deactivate RC
else Stock By Category
  UI -> RC: GET /api/reports/stock-by-category
  activate RC
  RC -> RS: getStockByCategory()
  activate RS
  RS -> DetailRepo: getStockByCategory()
  activate DetailRepo
  DetailRepo --> RS: List<Object[]>
  deactivate DetailRepo
  RS -> RS: map to List<StockByCategoryDto>
  RS --> RC: List<StockByCategoryDto>
  deactivate RS
  RC --> UI: 200 OK
  deactivate RC
end

== C. Recent Transactions ==
par Recent Imports
  UI -> ImportCtrl: GET /api/import-transaction/recent?limit=5
  activate ImportCtrl
  ImportCtrl --> UI: List<ImportTransactionResponseDto>
  deactivate ImportCtrl
else Recent Sales
  UI -> SaleCtrl: GET /api/sale-transactions/recent?limit=5
  activate SaleCtrl
  SaleCtrl --> UI: List<SaleTransactionResponseDto>
  deactivate SaleCtrl
end

UI --> Staff: Render boxes, charts, and recent tables

deactivate UI
deactivate Staff

@enduml 