@startuml Report_Class_Diagram_DevTeam_Vertical

skinparam backgroundColor white
skinparam classAttributeIconSize 0
skinparam packageStyle rectangle
skinparam classFontSize 11
skinparam classFontName Arial
skinparam classBackgroundColor #F8F9FA
skinparam classBorderColor #6C757D
skinparam arrowColor #495057
skinparam linetype ortho

title Report Module - Optimized Class Diagram
package "API Layer" {
  class ReportController {
    + getRemainByProduct()
    + getStocktakeDiff()
    + getStocktakeDiffById()
    + getExpiringLots()
    + getRevenueTrend()
    + getStockByCategory()
    + getTopProducts()
    + getTopCustomers()
    + getRemainByProductAdvanced()
    + getInOutSummary()
    + getRemainSummary()
    + getDailyRevenue()
    + getSalesTotal()
    + getImportsTotal()
    + getExpiringLotsAdvanced()
  }
  class JwtAuthenticationService
}

package "Service Layer" {
  interface ReportService {
    + report APIs...
  }

  class ReportServiceImpl {
    - importTransactionDetailRepository
    - stocktakeRepository
    - saleTransactionRepository
    - productRepository
    - zoneRepository
    - categoryRepository
    - importTransactionRepository
    - userRepository
    - request
    - objectMapper
  }
}

package "Repository Layer" {
  interface Repositories {
    + ImportTransactionDetailRepository
    + StocktakeRepository
    + SaleTransactionRepository
    + ProductRepository
    + ZoneRepository
    + CategoryRepository
    + ImportTransactionRepository
    + UserRepository
  }
}

package "DTOs" {
  package "Remain DTOs" {
    class ProductRemainDto {
      - productId
      - remain
    }
    class StocktakeDetailDto {
      - id
      - batchCode
      - productId
      - productName
      - remain
      - real
      - diff
      - expireDate
    }
    class RemainByProductReportDto {
      - category
      - zone
      - productName
      - status
      - remainQuantity
    }
    class CategoryRemainSummaryDto {
      - category
      - totalRemain
    }
    class ProductRemainSummaryDto {
      - productId
      - productName
      - totalRemain
    }
    class ZoneRemainSummaryDto {
      - zoneId
      - zoneName
      - totalRemain
    }
  }

  package "Expiring DTOs" {
    class ExpiringLotDto
    class ExpiringLotExtendedDto {
      - id
      - productCode
      - productName
      - lotCode
      - zoneName
      - expireDate
      - daysLeft
      - categoryId
      - categoryName
      - storeId
      - storeName
      - remainQuantity
    }
  }

  package "Revenue/Trend DTOs" {
    class RevenueTrendDto {
      - label
      - revenue
    }
    class DailyRevenueDto {
      - totalSaleAmount
      - totalImportAmount
      - netRevenue
    }
  }

  package "Summary/Total DTOs" {
    class StockByCategoryDto {
      - category
      - stock
    }
    class TopProductDto {
      - productName
      - category
      - quantity
    }
    class TopCustomerDto {
      - customerName
      - totalAmount
      - orderCount
    }
    class InOutSummaryDto {
      - date
      - importQuantity
      - exportQuantity
      - remainQuantity
    }
    class GroupTotalDto {
      - bucket
      - entityId
      - entityName
      - totalAmount
      - count
    }
    class SalesShiftTotalDto {
      - label
      - cashierId
      - cashierName
      - totalAmount
      - orderCount
    }
  }
}

' Relationships
ReportController --> ReportService : uses
ReportController --> JwtAuthenticationService : uses
ReportService <|.. ReportServiceImpl : implements
ReportServiceImpl --> Repositories
ReportService ..> ProductRemainDto
ReportService ..> StocktakeDetailDto
ReportService ..> ExpiringLotDto
ReportService ..> ExpiringLotExtendedDto
ReportService ..> RevenueTrendDto
ReportService ..> StockByCategoryDto
ReportService ..> TopProductDto
ReportService ..> TopCustomerDto
ReportService ..> RemainByProductReportDto
ReportService ..> InOutSummaryDto
ReportService ..> DailyRevenueDto
ReportService ..> GroupTotalDto
ReportService ..> SalesShiftTotalDto
ReportService ..> CategoryRemainSummaryDto

CategoryRemainSummaryDto "1" o-- "*" ProductRemainSummaryDto
ProductRemainSummaryDto "1" o-- "*" ZoneRemainSummaryDto

@enduml
