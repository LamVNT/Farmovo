@startuml Category_Update_Sequence

skinparam backgroundColor white
skinparam sequenceArrowThickness 2
skinparam sequenceMessageAlign center
skinparam sequenceGroupBodyBackgroundColor #F8F9FA
skinparam sequenceParticipantBorderColor #6C757D
skinparam sequenceParticipantBackgroundColor #E9ECEF
skinparam sequenceLifeLineStroke dash

title Update Category - Sequence Diagram

actor User as U
participant ":Category Page" as UI
participant ":Update Category Dialog" as CUI
participant ":CategoryController" as CC
participant ":CategoryService" as CS
participant ":CategoryValidator" as CV
participant ":CategoryMapper" as CM
participant ":CategoryRepository" as CR

== Request Phase ==
U -> UI: Chọn category, nhấn "Cập nhật"
activate U
activate UI
UI -> CUI: Mở dialog cập nhật
activate CUI
CUI -> U: Hiển thị form cập nhật
U -> CUI: Sửa name, description, nhấn "Lưu"
CUI -> CC: PUT /api/categories/{id} {name, description}
activate CC

CC -> CV: validate(requestDto)
activate CV
CV --> CC: validation result
deactivate CV

alt Validation Failed
    CC --> CUI: 400 Bad Request {error message}
    CUI --> U: Hiển thị lỗi
else Validation Passed
    CC -> CS: updateCategory(id, requestDto)
    activate CS
    CS -> CR: findById(id)
    activate CR
    CR --> CS: Optional<Category>
    deactivate CR
    alt Category Not Found
        CS --> CC: CategoryNotFoundException
        CC --> CUI: 404 Not Found {error message}
        CUI --> U: Hiển thị lỗi
    else Category Found
        CS -> CM: toEntity(requestDto)
        activate CM
        CM --> CS: Category entity
        deactivate CM
        CS -> CR: save(category)
        activate CR
        CR --> CS: Category entity
        deactivate CR
        CS -> CM: toResponseDto(category)
        activate CM
        CM --> CS: CategoryResponseDto
        deactivate CM
        CS --> CC: CategoryResponseDto
        deactivate CS
        CC --> CUI: 200 OK CategoryResponseDto
        CUI --> UI: Đóng dialog, cập nhật danh sách
        UI --> U: Hiển thị category đã cập nhật
    end
end

deactivate CC
deactivate CUI
deactivate UI
deactivate U

note right of CUI
    requestDto: name, description
    responseDto: id, name, description, updatedAt
end note

@enduml 