@startuml Category_Create_Sequence

skinparam backgroundColor white
skinparam sequenceArrowThickness 2
skinparam sequenceMessageAlign center
skinparam sequenceGroupBodyBackgroundColor #F8F9FA
skinparam sequenceParticipantBorderColor #6C757D
skinparam sequenceParticipantBackgroundColor #E9ECEF
skinparam sequenceLifeLineStroke dash

' Improved: Thêm UI, alt lỗi rõ ràng, note về DTO, validate tại Service

title Create Category - Sequence Diagram

actor User as U
participant ":Category Page" as UI
participant ":Create Category Dialog" as CUI
participant ":CategoryController" as CC
participant ":CategoryService" as CS
participant ":CategoryMapper" as CM
participant ":CategoryRepository" as CR

== Request Phase ==
U -> UI: Truy cập Category Page
activate U
activate UI
U -> UI: Nhấn "Tạo mới Category"
UI -> CUI: Mở dialog tạo mới
activate CUI
CUI -> U: Hiển thị form nhập thông tin
U -> CUI: Nhập name, description, nhấn "Lưu"
CUI -> CC: POST /api/categories {name, description}
activate CC

CC -> CS: createCategory(requestDto)
activate CS

CS -> CS: validate(requestDto)

alt Validation Failed
    CS --> CC: ValidationException
    CC --> CUI: 400 Bad Request {error message}
    CUI --> U: Hiển thị lỗi
else Validation Passed
    CS -> CM: toEntity(requestDto)
    activate CM
    CM --> CS: Category entity
    deactivate CM
    CS -> CR: save(category)
    activate CR
    CR --> CS: Category entity
    deactivate CR
    CS -> CM: toResponseDto(category)
    activate CM
    CM --> CS: CategoryResponseDto
    deactivate CM
    CS --> CC: CategoryResponseDto
    CC --> CUI: 201 Created + CategoryResponseDto
    CUI --> UI: Đóng dialog, cập nhật danh sách
    UI --> U: Hiển thị category mới
end

deactivate CS
deactivate CC
deactivate CUI
deactivate UI
deactivate U

note right of CUI
    requestDto: name, description
    responseDto: id, name, description, createdAt
end note

@enduml 